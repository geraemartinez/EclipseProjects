package ctc.traccar.web.rest.controllers;




import java.math.BigInteger;
import java.util.List;

import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;

import ctc.traccar.api.vos.GeofenceVo;
import ctc.traccar.api.vos.ReportVo;
import ctc.traccar.api.vos.UserSettingVo;
import ctc.traccar.api.vos.UserVo;
import ctc.traccar.business.interfaces.UserServiceInt;

@RestController
@RequestMapping("/User")
public class UserController {

		private static Logger logger = Logger.getLogger(UserController.class);
		
		@Autowired
		private UserServiceInt userService;
		
		@ModelAttribute("UserVo")
	    public UserVo getUserVo(){
	        return new UserVo();
	    }
		
		
		@RequestMapping(value="/Email/{email}",method=RequestMethod.GET,produces="application/json")
		@ResponseBody
		public ResponseEntity<List<UserVo>> GetUserByEmail(@PathVariable(value="email") String email) {			
			try {
				
				UserVo vo = new UserVo(email);
				List<UserVo> res = userService.getByEmail(vo);
				return new ResponseEntity<List<UserVo>>(res,HttpStatus.OK);
			
			}catch(Exception e){

				logger.error("[ERROR] Uncaught Exception - Internal server error at GetUserById: " + e.getMessage());
				return new ResponseEntity<List<UserVo>>(HttpStatus.INTERNAL_SERVER_ERROR);
			}
					
		}
		
		@RequestMapping(value="/{IdNumber}",method=RequestMethod.GET,produces="application/json")
		@ResponseBody
		public ResponseEntity<UserVo> GetUserById(@PathVariable(value="IdNumber") String id) {
			
			try {
				BigInteger Id = new BigInteger(id);
				UserVo vo = new UserVo(Id);				
				vo =  userService.getById(vo);
				return new ResponseEntity<UserVo>(vo,HttpStatus.OK);
				
			}catch(Exception e){
				
				logger.error("[ERROR] Uncaught Exception - Internal server error at GetUserById: " + e.getMessage());
				return new ResponseEntity<UserVo>(HttpStatus.INTERNAL_SERVER_ERROR);
			}
			
					
		}
		
		@RequestMapping(method=RequestMethod.GET,produces="application/json")
		@ResponseBody
		public ResponseEntity<List<UserVo>> GetAllUsers() {

			try {
			
				List<UserVo> result =  userService.getAll();
				return new ResponseEntity<List<UserVo>>(result,HttpStatus.OK);
			
			}catch(Exception e){

				logger.error("[ERROR] Uncaught Exception - Internal server error at GetAllUsers: " + e.getMessage());
				return new ResponseEntity<List<UserVo>>(HttpStatus.INTERNAL_SERVER_ERROR);
			}
			
					
		}
		
		@RequestMapping(value="/{IdNumber}/Geofences",method=RequestMethod.GET,produces="application/json")
		@ResponseBody
		public ResponseEntity<List<GeofenceVo>> GetUserGeofences(@PathVariable(value="IdNumber") String id) {
			try {
				
				BigInteger Id = new BigInteger(id);
				UserVo vo = new UserVo(Id);
				List<GeofenceVo> results =  userService.getGeofences(vo);
				return new ResponseEntity<List<GeofenceVo>>(results,HttpStatus.OK);
				
			}catch(Exception e){
				
				logger.error("[ERROR] Uncaught Exception - Internal server error at GetUserGeofences: " + e.getMessage());
				return new ResponseEntity<List<GeofenceVo>>(HttpStatus.INTERNAL_SERVER_ERROR);
			}
					
		}
		
		@RequestMapping(value="/{IdNumber}/Reports",method=RequestMethod.GET,produces="application/json")
		@ResponseBody
		public ResponseEntity<List<ReportVo>> GetUserReports(@PathVariable(value="IdNumber") String id) {			
			try {
				
				BigInteger Id = new BigInteger(id);
				UserVo vo = new UserVo(Id);
				List<ReportVo> results =  userService.getReports(vo);
				return new ResponseEntity<List<ReportVo>>(results,HttpStatus.OK);
				
			}catch(Exception e){
				
				logger.error("[ERROR] Uncaught Exception - Internal server error at GetUserReports: " + e.getMessage());
				return new ResponseEntity<List<ReportVo>>(HttpStatus.INTERNAL_SERVER_ERROR);
			}
					
		}
		
		@RequestMapping(value="/{IdNumber}/UserSettings",method=RequestMethod.GET,produces="application/json")
		@ResponseBody
		public ResponseEntity<UserSettingVo> GetUserSettings(@PathVariable(value="IdNumber") String id) {
			try {
				
				BigInteger Id = new BigInteger(id);
				UserVo vo = new UserVo(Id);
				UserSettingVo results =  userService.getUserSetting(vo);
				return new ResponseEntity<UserSettingVo>(results,HttpStatus.OK);
				
			}catch(Exception e){
				logger.error("[ERROR] Uncaught Exception - Internal server error at GetUserSettings: " + e.getMessage());
				return new ResponseEntity<UserSettingVo>(HttpStatus.INTERNAL_SERVER_ERROR);
			}
					
		}
		
		@RequestMapping(value="/login",method=RequestMethod.POST,produces="application/json")
		@ResponseBody
		public ResponseEntity<UserVo> GetUserAccess(@RequestBody UserVo vo) {

			try {
				
				UserVo result = userService.login(vo);
				return new ResponseEntity<UserVo>(result, HttpStatus.OK);
				
			}catch(Exception e){
				logger.error("[ERROR] Uncaught Exception - Internal server error at GetUserAccess: " + e.getMessage());
				return new ResponseEntity<UserVo>(HttpStatus.INTERNAL_SERVER_ERROR);
			}
			
		}
}
